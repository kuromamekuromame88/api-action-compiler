<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Web PlatformIO Editor</title>
<style>
  body { font-family: sans-serif; padding: 1em; }
  textarea { width: 100%; height: 300px; font-family: monospace; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>Web PlatformIO Editor</h2>
<textarea id="code">// src/main.cpp の内容をここに書く</textarea><br>
<button id="buildBtn">コンパイルを実行</button>

<pre id="log"></pre>

<script>
const GITHUB_USER = "kuromamekuromame88";
const REPO_NAME = "api-action-compiler";

document.getElementById("buildBtn").onclick = async () => {
  const log = document.getElementById("log");
  log.textContent = "ビルドリクエスト送信中...\n";

  const res = await fetch(
    `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/dispatches`,
    {
      method: "POST",
      headers: {
        "Accept": "application/vnd.github+json",
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        event_type: "web-build-request", // trigger.ymlのtypesと一致
      }),
    }
  );

  if (res.ok) {
    log.textContent += "✅ Actionsへのリクエストが送信されました！\n";
  } else {
    const err = await res.text();
    log.textContent += `❌ エラー: ${res.status}\n${err}\n`;
  }
};
</script>

</body>
</html>
