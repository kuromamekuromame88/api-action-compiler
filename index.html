<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Web PlatformIO Editor</title>
<style>
  body { font-family: sans-serif; padding: 1em; }
  textarea { width: 100%; height: 300px; font-family: monospace; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>Web PlatformIO Editor</h2>
<textarea id="code">// src/main.cpp の内容をここに書く</textarea><br>
<button id="buildBtn">コンパイルを実行</button>

<pre id="log"></pre>

<script>
const GITHUB_USER = "kuromamekuromame88";
const REPO_NAME = "api-action-compiler";

document.getElementById("buildBtn").onclick = async () => {
  const log = document.getElementById("log");
  log.textContent = "ビルドを開始します...\n";

  // workflow_dispatch を呼び出す
  const res = await fetch(
    `https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/actions/workflows/build.yml/dispatches`,
    {
      method: "POST",
      headers: {
        "Accept": "application/vnd.github+json",
        "Authorization": `Bearer ${YOUR_PAT}`, // ← 後述
      },
      body: JSON.stringify({
        ref: "main",
        inputs: { commit_message: "Web build" }
      })
    }
  );

  if (res.ok) {
    log.textContent += "✅ GitHub Actionsにジョブを送信しました。\n";
  } else {
    log.textContent += `❌ エラー: ${res.status}\n`;
  }
};
</script>

</body>
</html>
